<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Onelist Feature Branch Plan: Xamlr Blogging Platform - Onelist Roadmap</title>
  <style>
    :root {
      --bg: #0a0a0a;
      --card-bg: #141414;
      --border: #2a2a2a;
      --text: #e0e0e0;
      --text-muted: #888;
      --accent: #3b82f6;
      --accent-hover: #60a5fa;
      --code-bg: #1a1a1a;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
      padding: 2rem;
      max-width: 900px;
      margin: 0 auto;
    }
    
    .back-link {
      display: inline-block;
      margin-bottom: 2rem;
      color: var(--accent);
      text-decoration: none;
    }
    .back-link:hover { color: var(--accent-hover); }
    
    h1 { font-size: 2rem; margin-bottom: 0.5rem; }
    h2 { font-size: 1.5rem; margin-top: 2rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
    h3 { font-size: 1.25rem; margin-top: 1.5rem; margin-bottom: 0.75rem; }
    h4 { font-size: 1.1rem; margin-top: 1.25rem; margin-bottom: 0.5rem; }
    
    p { margin-bottom: 1rem; }
    
    a { color: var(--accent); }
    a:hover { color: var(--accent-hover); }
    
    code {
      background: var(--code-bg);
      padding: 0.2rem 0.4rem;
      border-radius: 0.25rem;
      font-size: 0.9em;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    pre {
      background: var(--code-bg);
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin-bottom: 1rem;
    }
    pre code {
      background: none;
      padding: 0;
    }
    
    ul, ol { margin-bottom: 1rem; padding-left: 1.5rem; }
    li { margin-bottom: 0.5rem; }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    th, td {
      border: 1px solid var(--border);
      padding: 0.5rem 0.75rem;
      text-align: left;
    }
    th { background: var(--card-bg); }
    
    blockquote {
      border-left: 3px solid var(--accent);
      padding-left: 1rem;
      margin: 1rem 0;
      color: var(--text-muted);
    }
    
    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 2rem 0;
    }
    
    .meta {
      color: var(--text-muted);
      font-size: 0.875rem;
      margin-bottom: 2rem;
    }
  </style>
</head>
<body>
  <a href="/roadmap/" class="back-link">â† Back to Roadmap Index</a>
  
  <article>
    <h1>Onelist Feature Branch Plan: Xamlr Blogging Platform</h1>
<strong>Document Version:</strong> 2025-05-06 (Final)
<strong>Feature Branch:</strong> Xamlr Blogging Platform
<strong>Baseline System:</strong> Onelist v2.0 (MVP + Completed Future Roadmap, including AI features, <code>entry_links</code> table, and Onelist support for <code>autoblog_by_tag</code> metadata and user-level preference for it per <code>entry_type</code>, and generation of <code>'display_html'</code> for all feasible <code>entry_types</code>).
<strong>Location Context:</strong> Concord, North Carolina, United States (as of May 6, 2025, ~7:04 PM EDT)
<h2>1. Feature Branch Goal & Vision</h2>
<p>Xamlr aims to be a sophisticated, multi-blog social blogging platform built as a separate application on top of Onelist v2.0. It will enable Onelist users to create and manage multiple distinct blogs, each with its own identity, theme, content stream (sourced from their Onelist account), and social interactions (followers, reblogs, likes). Xamlr will leverage Onelist as the headless CMS for content and identity, ensuring users always retain ownership and direct access to their core data within Onelist. Xamlr will provide the presentation layer, blog management tools, social features, and content discovery mechanisms for its blogging ecosystem.</p>
<h2>2. Xamlr Core Architecture</h2>
<em> <strong>A. Separate Elixir/Phoenix Application:</strong>
  </em> Xamlr will be developed as an independent Elixir/Phoenix application, distinct from the Onelist Core application.
  <em> It will have its own database for Xamlr-specific data.
  </em> It will interact with Onelist primarily via Onelist's authenticated REST API.
<em> <strong>B. Onelist as Headless CMS & Identity Provider:</strong>
  </em> <strong>Content Storage:</strong> All primary blog post content (text, media) originates from or is stored as Onelist <code>entries</code>, with their respective <code>representations</code> (including a <code>'display_html'</code> version generated by Onelist for all feasible types) and <code>assets</code>.
  <em> <strong>Identity:</strong> Onelist will serve as the Identity Provider (IdP) for Xamlr. Users will sign up/log in to Xamlr using their Onelist credentials (or Xamlr signup will seamlessly create a Onelist account).
  </em> <strong>Blog Configuration Storage:</strong> The core configuration for each Xamlr blog (e.g., title, source Onelist tags, theme identifier, privacy settings, per-blog blocked tags, visibility rules) will be stored as a dedicated <code>entry</code> of <code>entry_type='blog_config'</code> within the user's Onelist account (likely in its <code>metadata</code> field). Xamlr provides the UI to manage these Onelist entries.
<em> <strong>C. Xamlr's Own Database:</strong>
  </em> Xamlr will maintain its own database for data specific to its operations and social features, including:
    <em> Mapping Onelist user IDs to Xamlr user profiles/states if needed.
    </em> Internal Xamlr identifiers for blogs (mapping to Onelist <code>'blog_config'</code> entries).
    <em> <code>blog_publications</code> table: Tracks each instance of a Onelist <code>entry</code> being published to a specific Xamlr blog, including its Xamlr-specific <code>public_id</code>, publication status (<code>draft</code>, <code>queued</code>, <code>published</code>), <code>publication_timestamp</code>, and <code>publication_tags</code>.
    </em> <code>xamlr_blog_follows</code> table: Stores blog-to-blog follow relationships within Xamlr.
    <em> <code>xamlr_likes</code> table: Stores "like" interactions on Xamlr posts.
    </em> <code>xamlr_blog_followed_tags</code> table: Stores tags that specific Xamlr blogs are following for their "Your Tags" feed.
    <em> Theme settings/customizations beyond basic identifiers (if any post-MVP).
    </em> Publishing queue state (managed via <code>blog_publications</code> status and timestamps).
    <em> User preferences specific to the Xamlr application (e.g., Xamlr UI theme, default blog on login).
    </em> Cached data from Onelist.
    <em> (Post-MVP) Comments, detailed analytics data.
</em> <strong>D. ID Generation and Usage:</strong>
  <em> <strong>Internal Xamlr IDs:</strong> Xamlr will use UUIDs (stored as native UUID type) for primary keys in its own database tables.
  </em> <strong>References to Onelist Entries:</strong> Xamlr will store and use Onelist's internal <code>entry.id</code> (UUID, stored as native UUID type in Xamlr's DB as <code>onelist_entry_id</code>) for fetching and referencing Onelist content.
  <em> <strong>Public-Facing Xamlr Post IDs (<code>xamlr_public_id</code>):</strong> Xamlr will generate its own distinct, opaque string identifiers (e.g., nanoid) for posts published on its platform. These <code>xamlr_public_id</code>s will be used in Xamlr blog URLs, ensuring Onelist <code>entry.public_id</code>s are not directly exposed.
</em> <strong>E. Privacy & Blog Independence Architecture:</strong>
  <em> <strong>Public Anonymity of Blog Ownership:</strong> Xamlr will not publicly link different blogs owned by the same Onelist user or expose Onelist user identifiers on public blog pages.
  </em> <strong>Activity Masking System (Xamlr-Level):</strong> Xamlr may implement mechanisms (e.g., slight randomized delays, independent publication timestamps) to obscure timing correlations between a user's actions in Onelist and post appearances on Xamlr, or across different Xamlr blogs they own.
  <em> <strong>Isolated Storage Pools (Xamlr Database):</strong> Xamlr's database will ensure strict data segregation for information pertaining to different blogs.
  </em> <strong>Decentralized Analytics (within Xamlr - Post-MVP):</strong> Analytics collected by Xamlr will be strictly per-blog, with no cross-blog aggregation provided to users by Xamlr.
<em> <strong>F. User Onboarding, Authentication, and Onelist Account Integration:</strong>
  </em> <strong>Seamless Account Creation:</strong> Xamlr signup will automatically create a Onelist account if one doesn't exist for the provided credentials, clearly informing the user.
  <em> <strong>Onelist as IdP:</strong> Xamlr delegates authentication to Onelist.
  </em> <strong>Xamlr Onboarding Wizard (MVP):</strong> A multi-step wizard guides new users through setting up their first Xamlr blog (creating the Onelist <code>'blog_config'</code> entry), basic theme selection, optional initial content sourcing (tag-based), dashboard intro, and optional initial tag/blog following. Supports persistent onboarding state. Includes a completion step with clear calls to action.
<h2>3. Key Xamlr-Specific Features</h2>
<em> <strong>A. Multi-Blog Management (MVP):</strong> Users can create and manage multiple distinct blogs from a single Onelist account.
</em> <strong>B. Dashboard Core Organization & Panes (MVP):</strong>
    The Xamlr user dashboard (experienced within the context of the active blog) will include:
    1. <strong>"For You" Pane (MVP - Basic):</strong> A content discovery feed populated by simple automated mechanisms:
        <em> "Top Reblogged Posts (Last 24 Hours)."
        </em> "Top Reblogged Posts in Trending Tags (Last 24 Hours)" (requires Xamlr to identify simple trending tags by recent usage).
        <em> "Spotlight on New Voices" (featuring posts from newly created Xamlr blogs).
        </em> "Posts Related to Your Active Blog's Tags" (conditional on active blog having >= 5 distinct tags).
        <em> "Most Liked Posts (Last 24 Hours)."
        </em> (Sophisticated algorithmic personalization is Post-MVP).
    2. <strong>"Following" Pane (MVP):</strong> Chronological feed of posts from Xamlr blogs the active blog follows.
    3. <strong>"Your Tags" Pane (MVP):</strong> Chronological feed of public posts from across Xamlr matching tags the active blog follows (combined OR logic for followed tags).
    4. <strong>"Your Content" Pane (MVP):</strong> View of the user's own Onelist <code>entries</code>, with search/filter capabilities (including filtering out what's already published on the active Xamlr blog).
<em> <strong>C. Universal Post Actions & Publishing Modal (MVP):</strong>
  </em> Consistent actions ("Post directly" from "Your Content"; "Reblog," "Queue," "Draft" from all feeds) available on displayed items.
  <em> A unified modal for these actions, allowing users to add commentary and switch between final actions (Post, Reblog, Queue, Draft - all MVP).
  </em> <strong>Storage of Xamlr-Added Commentary:</strong> All commentary added via Xamlr <strong>must be stored as part of a Onelist <code>entry</code></strong> (typically a new copy of the source entry, with commentary as a new <code>representation</code>). Xamlr does not store this commentary in its own database.
<em> <strong>D. Feed-Specific Management & Features (MVP & Post-MVP):</strong>
  </em> <strong>"Following" Feed (MVP):</strong> Chronological, server-side scroll position persistence, manual refresh (pull-down mobile, button desktop), unread count display, defined empty state with CTAs ("Discover Blogs" to "For You"; "Browse by Tags" to "Your Tags"; "Search Blogs").
    <em> </em>(Post-MVP: Real-time updates, granular "last read" markers, jump-to-new).<em>
  </em> <strong>"Your Tags" Pane (MVP):</strong> Blog follows tags, combined chronological feed, single-tag drill-down view, post-level content filtering via layered blocked tags (user-global + per-blog), manual refresh.
    <em> </em>(Post-MVP: Advanced tag management, sophisticated aggregation/filtering, alternative display modes).<em>
  </em> <strong>Post-Level Content Filtering via Layered "Blocked Tags" (MVP):</strong>
    <em> <strong>User's Global Blocked Tags List:</strong> Stored in Onelist user profile/settings, applies to all user's Xamlr blogs.
    </em> <strong>Per-Blog Specific Blocked Tags:</strong> Stored in the Onelist <code>'blog_config'</code> entry for that blog.
    <em> Xamlr uses both lists to hide content by default in feeds, with a "Display anyway?" option.
</em> <strong>E. Core Social Engagement Features (MVP):</strong>
  <em> <strong>Blog-to-Blog Following:</strong> Active blog follows other Xamlr blogs (stored in Xamlr DB).
  </em> <strong>Reblogging (with Onelist Content Integration):</strong> Creates a new Onelist <code>entry</code> copy in the reblogger's Onelist. Includes sophisticated comment chain handling: previous comments (as <code>representations</code>) are copied, current reblogger can omit some, and add their new comment as a new <code>representation</code>.
    <em> <strong>Rich Attribution Display (MVP):</strong> Each comment layer in a reblog chain displays the authoring Xamlr blog's avatar and name (both linking to that blog), sourced using the Onelist internal <code>id</code> of the authoring blog's <code>'blog_config'</code> entry stored in the comment <code>representation</code>'s metadata.
  </em> <strong>Likes:</strong> Users (as their active blog) can like/unlike Xamlr posts. Counts displayed. (Stored in Xamlr DB).
<em> <strong>F. "Save to Onelist" Feature (MVP):</strong>
  </em> Allows users to save a copy of any Xamlr post's underlying Onelist <code>entry</code> (including its original tags and any Xamlr-added commentary from the post being saved) to their own Onelist account. This action uses the unified publishing modal for optional added commentary (which becomes part of the new copy). Sets the <code>autoblog_by_tag: "no"</code> flag on the new Onelist copy by default.
<em> <strong>G. Blog Privacy & Visibility Settings (MVP):</strong>
  </em> Stored in the Onelist <code>'blog_config'</code> <code>entry.metadata</code>.
  <em> <code>visibility</code> field with values:
    </em> <code>"public"</code>: Fully open (NOT allowed for NSFW blogs).
    <em> <code>"logged_in"</code>: Requires Xamlr login to view content (default for new NSFW blogs).
    </em> <code>"following"</code>: Only viewable by Xamlr blogs that the private blog <em>is currently following</em>.
  <em> Follower/Following lists are public by default but can be toggled private per blog (setting stored in Onelist <code>'blog_config'</code> entry).
  </em> All public posts are rebloggable by default in MVP.
<em> <strong>H. Content Creation & Management within Xamlr (MVP):</strong>
  </em> <strong>Flexible Content Origination:</strong> Supports Onelist-first (tagging existing entries) and Xamlr-first (using Xamlr editor, saves to Onelist).
  <em> <strong>Xamlr Content Editor:</strong> Simple Markdown editor (like Onelist's), with media upload functionality that creates Onelist <code>assets</code> and embeds their URLs.
  </em> <strong>Authorship:</strong> The Xamlr blog itself is displayed as the author. No Onelist user info is publicly exposed by Xamlr.
<em> <strong>I. Xamlr Draft Management & Synchronization (MVP):</strong>
  </em> "Draft" action in publishing modal creates a draft-status Onelist <code>entry</code> (typically a copy with any Xamlr-added commentary). Xamlr <code>blog_publications</code> table marks it as <code>'draft'</code>.
  <em> Drafts are accessible/editable in Xamlr across devices (as they are backed by Onelist entries). Xamlr dashboard provides a "Drafts" view per blog.
</em> <strong>J. Xamlr-Specific Analytics (MVP & Post-MVP):</strong>
  <em> <strong>MVP:</strong> Display individual post reblog and like counts. No dashboards.
  </em> <strong>Post-MVP:</strong> Comprehensive analytics suite (Post, Tag, Media usage analytics within Xamlr, reporting levels).
<em> <strong>K. Global User Display Preferences for Xamlr Application (MVP):</strong>
  </em> Stored in Xamlr's DB, linked to Onelist User ID.
  <em> <strong>UI Theme (MVP):</strong> Dark/Light/System options for the Xamlr application interface.
  </em> <strong>Default View at Login (MVP):</strong> Defaults to user's designated "default Xamlr blog's" dashboard, showing the "Following" pane.
  <em> <strong>Auto-Save Liked Posts to Onelist Setting (Post-MVP):</strong> User preference (default OFF) to automatically trigger "Save to Onelist" upon liking a post. Xamlr sets <code>autoblog_by_tag: "no"</code> on these copies based on another Xamlr setting.
</em> <strong>L. Settings Management for Individual Xamlr Blogs (MVP):</strong>
  <em> Managed via Xamlr UI, stored in Onelist <code>'blog_config'</code> <code>entry.metadata</code>. Includes:
    </em> Basic Theme Configuration.
    <em> Content Sourcing Rules (Onelist tags, <code>entry_type</code> exclusions like for <code>'chat_log'</code>).
    </em> Follower/Following List Privacy toggles.
    <em> Per-Blog Blocked Tags list.
    </em> Per-blog language and timezone.
    <em> Configurable Queue Schedule/Rate (e.g., X posts per day).
    </em> Blog Visibility Level (<code>"public"</code>, <code>"logged_in"</code>, <code>"following"</code>), respecting NSFW constraints.
<em> <strong>M. Content Sourcing, Cross-Publication, and Queuing Logic (MVP):</strong>
  </em> <strong>Tag-Sourced Content:</strong> Onelist entries matching a blog's sourcing tags (and where <code>entry.metadata.autoblog_by_tag</code> is <code>"yes"</code>) are added to that blog's Xamlr publishing queue.
  <em> <strong><code>autoblog_by_tag</code> Control:</strong>
    </em> Onelist <code>entries</code> have a user-configurable <code>metadata.autoblog_by_tag: "yes"|"no"</code> field (with Onelist user settings for type-defaults). Xamlr respects this for auto-queuing.
    <em> Xamlr provides user settings to determine if Xamlr-created Onelist <code>entry</code> copies (via Reblog, Save to Onelist, Like & Auto-Save) should have <code>autoblog_by_tag</code> set to <code>"no"</code> (default is <code>"no"</code>).
  </em> <strong>Xamlr Publishing Queue (MVP):</strong> Simple, time-based processing based on per-blog rate. <code>blog_publications</code> records with <code>status='queued'</code> and a <code>publication_timestamp</code>.
<em> <strong>N. Xamlr Media Library Browser (Post-MVP):</strong> UI within Xamlr to browse user's Onelist assets for easy reuse in Xamlr posts.
</em> <strong>O. Advanced Content Scheduling (Post-MVP):</strong> Interval posting, time windows, manual queue sorting, random posting from queue.
<em> <strong>P. Edit Propagation/Cascade for Reblogs (Long-Term Post-MVP Exploration):</strong> Optional edit propagation.
</em> <strong>Q. Post Editing & Versioning (Leveraging Onelist):</strong>
  <em> <strong>MVP:</strong> Edits in Xamlr update Onelist <code>representation</code>. Rollbacks via Onelist UI.
  </em> <strong>Post-MVP:</strong> Simple Xamlr UI to view Onelist <code>representation_versions</code> and trigger rollbacks.
<em> <strong>R. Advanced Blog Management Features (Post-MVP):</strong> Bulk Settings Management, Template System for New Blogs.
</em> <strong>S. Import/Export of Xamlr Configurations (Post-MVP Consideration):</strong> For Xamlr-specific settings.
<h2>4. Data Model within Xamlr (Key Tables - Summary)</h2>
<em> <code>Users</code>: Maps Onelist user IDs to Xamlr-specific user data/preferences.
</em> <code>Blogs</code>: Defines Xamlr-specific attributes for a blog, linking to its Onelist <code>'blog_config'</code> <code>entry_id</code>.
<em> <code>Blog_Publications</code>: Central table mapping Xamlr blog posts (with <code>xamlr_public_id</code>) to Onelist <code>entries</code> (<code>onelist_entry_id</code>), storing publication status, timestamp, title, <code>publication_tags</code>, reblog info.
</em> <code>Xamlr_Blog_Follows</code>: Tracks blog-to-blog follows.
<em> <code>Xamlr_Likes</code>: Tracks likes on Xamlr posts.
</em> <code>Xamlr_Blog_Followed_Tags</code>: Tags followed by specific Xamlr blogs for their "Your Tags" feed.
<em> <code>Xamlr_User_Feed_States</code>: Stores scroll positions, etc. (e.g., for "Following" feed MVP).
</em> (Potentially other tables for themes if customization grows, Xamlr-specific drafts if not immediately pushed to Onelist, comments post-MVP, analytics data post-MVP).
<h2>5. Interaction with Onelist v2.0 (Key Requirements for Onelist API)</h2>
<em> Robust Authentication (OAuth2).
</em> CRUD operations for Onelist <code>entries</code>, <code>representations</code>, and <code>assets</code>.
<em> Ability to create copies of Onelist <code>entries</code>, including selected <code>representations</code> and tags, and allow addition of new <code>representations</code> (for reblogs/commentary).
</em> Management of <code>entry.metadata</code>, including the <code>autoblog_by_tag</code> flag and flags set by Xamlr (like NSFW for a <code>'blog_config'</code> entry).
<em> API access to Onelist user settings for managing <code>autoblog_by_tag</code> defaults per <code>entry_type</code> and the user's global blocked tags list.
</em> Powerful search/query API:
  <em> Filter by <code>entry_type</code>, <code>public</code> status, tags (contains any of, contains all of).
  </em> Filter by <code>metadata</code> fields (specifically <code>autoblog_by_tag</code>).
  <em> Efficient pagination (cursor-based preferred).
  </em> Sorting options.
<em> Onelist to generate <code>'display_html'</code> for all feasible <code>entry_types</code>.
</em> (Post-MVP for Onelist, but anticipated by Xamlr): Webhook system for notifying external apps of changes to Onelist entries.
<h2>6. Xamlr-Specific Security Considerations</h2>
<em> Adherence to Zero Trust, Defense in Depth, Privacy by Default, Least Privilege Access.
</em> Secure session management for Xamlr.
<em> Secure handling of Onelist API tokens.
</em> Robust input validation and output encoding.
<em> Deferral of application-level encryption at rest for Xamlr's own database in MVP (to be re-evaluated if deferral causes issues).
<h3>6.1 E2EE and Public Blog Content</h3>
<strong>Critical Architecture Constraint:</strong> Onelist uses E2EE for private content, but Xamlr blog posts are public by definition.
<strong>The Problem:</strong>
<ul>
<li>Onelist private entries are end-to-end encrypted (server cannot read)</li>
<li>Xamlr blog posts must be readable by anyone visiting the blog</li>
<li>Therefore, all published Xamlr content requires <strong>unencrypted</strong> representations</li>
<strong>How Xamlr Handles This:</strong>
<p>The <code>display_html</code> representation is generated on every content change in Onelist, stored in PostgreSQL alongside encrypted content:</p>
<pre><code class="language-">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONTENT CHANGE IN ONELIST                                                   â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  Generate ALL representations (stored in PostgreSQL):                        â”‚
â”‚  â”œâ”€â”€ markdown (encrypted) â”€â”€â”€â”€â”€â”€â–º User's private copy                       â”‚
â”‚  â”œâ”€â”€ summary (encrypted) â”€â”€â”€â”€â”€â”€â”€â–º Private AI summary                        â”‚
â”‚  â””â”€â”€ display_html (plaintext) â”€â”€â–º Always generated, ready for Xamlr         â”‚
â”‚                                                                              â”‚
â”‚  PUBLISHING TO XAMLR                                                         â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  Xamlr fetches <code>display_html</code> via Onelist API                               â”‚
â”‚  display_html already exists â”€â”€â–º Instant publishing                         â”‚
â”‚  Cloudflare CDN caches blog pages at edge                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<strong>Storage:</strong> All representations in PostgreSQL (no separate buckets). Cloudflare CDN in front of the app handles traffic scaling.
<strong>Representation Types in Onelist:</strong>
<table>
<tr><th>Type</th><th>Encrypted?</th><th>Purpose</th></tr>
<tr><td><code>markdown</code></td><td>Yes (E2EE)</td><td>User's private source content</td></tr>
<tr><td><code>summary</code></td><td>Yes (E2EE)</td><td>AI-generated summary, private</td></tr>
<tr><td><code>display_html</code></td><td><strong>No</strong></td><td>Pre-rendered HTML (always generated)</td></tr>
</table>
<strong>User Consent & Visibility:</strong>
<p>Xamlr should clearly communicate:
<li>"Publishing makes this content publicly viewable"</li>
<li>"Published content is stored unencrypted so visitors can read it"</li>
<li>"Your private Onelist copy remains end-to-end encrypted"</li></p>
<strong>Blog Visibility Levels:</strong>
<li><code>public</code>: Content accessible to anyone</li>
<li><code>logged_in</code>: Requires Xamlr login (access-controlled)</li>
<li><code>following</code>: Only followers can view (access-controlled)</li>
<p>All visibility levels use <code>display_html</code> because Xamlr cannot decrypt E2EE content - only the owning user's client can.</p>
<strong>Reblog Implications:</strong>
When reblogging, the new entry copy also gets <code>display_html</code> generated:
1. Original entry's <code>display_html</code> content is included
2. Reblogger's commentary is rendered to HTML
3. Combined <code>display_html</code> generated for the new entry
4. See Asset Handling below for images in reblogs
<h3>6.2 Asset Handling for Xamlr Posts</h3>
<p>Xamlr posts can contain images and media. Since blog posts are public, these assets need public URLs.</p>
<strong>Media Upload Flow:</strong>
<pre><code class="language-">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER UPLOADS IMAGE IN XAMLR EDITOR                                          â”‚
â”‚                                                                              â”‚
â”‚  1. Image uploaded to Onelist as E2EE asset (standard flow)                 â”‚
â”‚     â”œâ”€â”€ Encrypted with user's key                                           â”‚
â”‚     â””â”€â”€ Stored in private bucket                                            â”‚
â”‚                                                                              â”‚
â”‚  2. When post is PUBLISHED to Xamlr:                                        â”‚
â”‚     â”œâ”€â”€ Decrypt image with user's key                                       â”‚
â”‚     â”œâ”€â”€ Upload plaintext to R2 public bucket                                â”‚
â”‚     â”œâ”€â”€ Store URL in asset.public_url                                       â”‚
â”‚     â”œâ”€â”€ Add entry.id to asset.public_entry_ids                              â”‚
â”‚     â””â”€â”€ display_html references asset.public_url                            â”‚
â”‚                                                                              â”‚
â”‚  3. Blog viewers see image via R2 public URL                                â”‚
â”‚     â””â”€â”€ Cached at Cloudflare edge                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<strong>Draft vs Published:</strong>
<table>
<tr><th>State</th><th>Asset Storage</th><th>Public URL</th></tr>
<tr><td>Draft</td><td>E2EE only</td><td>None</td></tr>
<tr><td>Queued</td><td>E2EE only</td><td>None (generated at publish time)</td></tr>
<tr><td>Published</td><td>E2EE + R2 public</td><td>Yes</td></tr>
</table>
<p>Assets are only published to R2 when the post actually goes live, not when queued.</p>
<strong>Reblog with Images:</strong>
<p>When reblogging a post that contains images:</p>
<pre><code class="language-">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REBLOGGING POST WITH IMAGES                                                 â”‚
â”‚                                                                              â”‚
â”‚  Original post (Alice's blog):                                              â”‚
â”‚  â”œâ”€â”€ Entry with image asset                                                 â”‚
â”‚  â””â”€â”€ asset.public_url = &quot;https://r2.../alice-img-abc.jpg&quot;                   â”‚
â”‚      asset.public_entry_ids = [alice_entry_id]                              â”‚
â”‚                                                                              â”‚
â”‚  Bob reblogs:                                                               â”‚
â”‚  1. New entry created in Bob's Onelist (copy)                               â”‚
â”‚  2. Image asset copied to Bob's Onelist (E2EE)                              â”‚
â”‚  3. On publish:                                                             â”‚
â”‚     â”œâ”€â”€ Bob's copy gets its own public_url (separate R2 file)              â”‚
â”‚     â””â”€â”€ OR references Alice's public_url (adds to her ref count)            â”‚
â”‚                                                                              â”‚
â”‚  Recommended: Separate copy                                                  â”‚
â”‚  - Bob's reblog survives if Alice deletes original                         â”‚
â”‚  - No cross-user reference counting complexity                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<strong>"Save to Onelist" with Assets:</strong>
<p>When a user saves a Xamlr post to their Onelist:</p>
<p>1. Entry copied to user's Onelist (with <code>autoblog_by_tag: "no"</code>)
2. Assets copied to user's Onelist (E2EE)
3. <strong>No public_url on saved copy</strong> (it's private by default)
4. If user later makes their copy public, standard asset publish flow applies</p>
<strong>Unpublishing / Deleting Posts:</strong>
<p>When a Xamlr post is unpublished or deleted:
<li>Remove entry from <code>asset.public_entry_ids</code></li>
<li>If <code>public_entry_ids</code> empty, delete from R2, set <code>public_url = null</code></li>
<li>E2EE copy in user's Onelist remains unchanged</li></p>
<strong>User Consent for Publishing:</strong>
<p>When publishing a post with assets, Xamlr should show:</p>
<pre><code class="language-">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PUBLISH TO [BLOG NAME]                                    â”‚
â”‚                                                                              â”‚
â”‚  This post contains 2 images that will be made public:                      â”‚
â”‚                                                                              â”‚
â”‚    ğŸ“· header-image.jpg (890 KB)                                             â”‚
â”‚    ğŸ“· diagram.png (245 KB)                                                  â”‚
â”‚                                                                              â”‚
â”‚  â€¢ Images will be decrypted and stored at public URLs                       â”‚
â”‚  â€¢ Anyone visiting your blog can view them                                  â”‚
â”‚  â€¢ Your private Onelist copies remain encrypted                             â”‚
â”‚                                                                              â”‚
â”‚           [Save as Draft]  [Queue]  [Publish Now]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<strong>Media Library Browser (Post-MVP):</strong>
<p>The planned Media Library Browser should:
<li>Show which assets have public copies (published somewhere)</li>
<li>Display <code>public_entry_ids</code> count ("Used in 3 published posts")</li>
<li>Allow viewing which posts reference each asset</li>
<li>Warn before deleting assets that are publicly referenced</li>
</ul>
See <a href="./mvp_public_content_plan.md">MVP Public Content Plan</a> for full asset handling architecture.</p>
<h2>7. MVP for Xamlr Feature Branch (Summary of Key Inclusions)</h2>
</em> Multi-blog per user with strong privacy/isolation.
<em> Basic theming (avatar, cover, description, simple color/font schemes).
</em> Core Social Features: Blog-to-blog following; Reblogging (with Onelist copy, comment chain management & rich attribution display); Likes on posts; Display of like/reblog counts on posts.
<em> Dashboard with 4 Panes:
  </em> "For You" (basic discovery: top reblogs, top reblogs in trending tags, new voices, posts related to active blog's tags [conditional], most liked).
  <em> "Following" (chronological, server-side scroll persistence, manual refresh, unread count).
  </em> "Your Tags" (chronological OR feed of followed tags, post-level blocking via user-global & per-blog blocked tag lists, single tag drill-down, manual refresh).
  <em> "Your Content" (browse/filter user's Onelist entries, actions to post/queue/reblog).
</em> Universal Post Actions & Publishing Modal: Supports "Post directly," "Reblog," "Queue," and "Draft" actions, allows adding commentary (stored in Onelist entry copy).
<em> Onboarding Wizard: Guides new users through seamless Onelist account creation (if needed), first blog setup (creating Onelist <code>'blog_config'</code> entry), basic theming, optional content sourcing (tag-based, with <code>entry_type</code> exclusion for AI chat logs), dashboard intro, initial feed population, and completion step with CTAs. Supports persistent onboarding state.
</em> "Save to Onelist" button on posts.
<em> NSFW Content Handling: Marking blogs as NSFW (via <code>'blog_config'</code> entry setting), respecting NSFW flags from Onelist entries, basic age verification for viewing/publishing NSFW content. NSFW blogs cannot be <code>visibility: "public"</code>.
</em> Blog Settings (MVP, stored in Onelist <code>'blog_config'</code> entry): Basic theme config, content sourcing rules, follower/following list privacy toggles, per-blog blocked tags, language, timezone, queue rate, blog visibility (<code>"public"</code>, <code>"logged_in"</code>, <code>"following"</code>).
<em> Global Xamlr User Display Preferences (MVP, stored in Xamlr DB): UI Theme (Dark/Light/System), default blog/pane at login.
</em> Content Sourcing & Queuing: Tag-based sourcing adds to Xamlr queue, respects Onelist <code>entry.metadata.autoblog_by_tag</code> flag. Xamlr settings control this flag for Xamlr-generated copies (defaulting to "no" for copies). Basic queue processing.
<em> Xamlr-Specific <code>public_id</code> for posts.
</em> Performance: In-application caching (Elixir/OTP, TTL) for Onelist data; Lazy loading for feeds.
<em> Editor: Simple Markdown editor in Xamlr with media uploads to Onelist <code>assets</code>.
</em> Authorship: Blog displayed as author.
<h2>8. Future Evolution for Xamlr (Beyond Initial Post-MVP Features from above)</h2>
<em> Sophisticated algorithmic "For You" feed.
</em> Advanced dashboard state persistence and feed features (real-time updates, granular unread/position markers).
<em> Advanced tag management and feed aggregation for "Your Tags."
</em> Comments system.
<em> Detailed Xamlr-specific analytics dashboards.
</em> Custom domain mapping.
<em> Advanced Content Scheduling for the queue.
</em> Xamlr Media Library Browser UI (for Onelist assets).
<em> UI for Onelist entry version history/rollback from within Xamlr.
</em> Exploration of edit propagation for reblogs.
<em> Advanced Blog Management: Bulk Settings Management, Template System for New Blogs.
</em> Import/Export of Xamlr Configurations.
<em> More advanced theme customization.
<h2>9. Risks/Challenges</h2>
</em> <strong>Complexity of Xamlr Application:</strong> Even as an API client, Xamlr is a feature-rich social application with its own significant logic and database needs.
<em> <strong>Performance of Onelist API:</strong> Xamlr's performance will heavily depend on the responsiveness and query capabilities of the Onelist API, especially for feed generation and content discovery.
</em> <strong>Data Synchronization/Consistency:</strong> Ensuring consistency between Xamlr's state/cache and Onelist's data, especially before Onelist has webhooks.
<em> <strong>User Experience for Dual Systems:</strong> Clearly communicating to users the relationship between Xamlr and Onelist, and where different data/settings reside.
</em> <strong>Scalability of Xamlr's Social Features:</strong> If Xamlr becomes very popular, scaling its own database and social graph operations will be a challenge.
<em> <strong>Scope Management for Xamlr MVP and iterations.</strong>
<h2>10. To Research</h2>
</em> <https://venturebeat.com/ai/meet-alphaevolve-the-google-ai-that-writes-its-own-code-and-just-saved-millions-in-computing-costs/?utm_source=flipboard&utm_content=user%2Fventurebeat> for For You algorithm
  </article>
</body>
</html>
